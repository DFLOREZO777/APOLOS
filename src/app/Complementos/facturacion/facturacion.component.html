
<app-navbar *ngIf="arregloDetalle.length == 0"></app-navbar>


<div class="container-fluid mx-0">

    <div class="card">
        <div class="h3 card-tittle" style="text-align: center;">FACTURACION</div>
        <div class="card-body" style="height:152px; padding: 0%;">
            <form [formGroup]="crearFactura" (ngSubmit)="agregarFactura()">
                <div class="container-fluid mx-0 ">
                    <div class="row ">
                        <div class="col">
                            <label class="col-sm-2 col-form-label-lg ">Remi:</label>
                            <input id="remision" type="text" class="offset-lg-2 " formControlName="remision"
                                [attr.disabled]="true" placeholder="{{remIni}}">
                        </div>
                        <div class="col">
                            <label class="col-sm-2 col-form-label pl-4">Usu:</label>
                            <input id="usuario" type="text" placeholder="{{dataUser}}" formControlName="usuario"
                                [attr.disabled]="true">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label class="col-sm-4 col-form-label">Fec/hr:</label>
                            <input class="" type="text" placeholder="{{fecha}}" formControlName="fecha"
                                [attr.disabled]="true">
                        </div>
                        <div class="col form-inline">
                            <label class="col-sm-2 col-form-label">Tipo Fac:</label>
                            <select id="tipoFac" class="col-sm-4 form-control" required formControlName="tipoFact">
                                <option selected>Venta</option>
                                <option selected>Apartado</option>

                            </select>

                        </div>
                    </div>
                    <div class="row ml-1 mt-2">
                        <form class=" row bg-white " [formGroup]="clienteD">
                            <div class="form-group col-md-4">
                                <label>No Doc:</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class=" bi bi-search" (click)="openModalClientes()"></i>
                                    </span>
                                    <input id="documento" type="text" class="form-control" formControlName="documento"
                                        placeholder="Documento Cli" (keydown.enter)="callCliente($event)">
                                </div>

                            </div>
                            <div class="form-group col-md-3">
                                <label>Nom Cli:</label>
                                <input type="text" class="form-control" formControlName="nombre"
                                    placeholder="Nombre Cli" [attr.disabled]="true">
                            </div>
                            <div class="form-group col-md-4">
                                <label>Tel Cli:</label>
                                <input type="text" class="form-control" formControlName="telefono"
                                    placeholder="Telefono Cli" [attr.disabled]="true">
                            </div>

                            <div class="form-group col-md-1 d-flex justify-content-center py-4 mt-2">
                                <button type="button" class="btn btn-danger" (click)="clearClie()">
                                    <i class="bi bi-trash" ></i>
                                </button>
                            </div>

                        </form>
                      
                    </div>
                    <section class="row mt-1">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <form class="row" [formGroup]="detallesF" name="detalles">

                                        <div class="form-group col-sm-3">
                                            <label >Producto</label>
                                            <input type="text" class="form-control" formControlName="nombre"
                                                [attr.disabled]="true">
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label >Referencia</label>
                                            <div class="input-group">
                                                <span class="input-group-text">
                                                    <i class=" bi bi-search" (click)="openModalProductos()"></i>
                                                </span>
                                                <input class="form-control" formControlName="referencia"
                                                    (keydown.enter)="callProducto($event)"
                                                    (keydown.enter)="referenciaId($event)">
                                            </div>
                                        </div>
                                        <div class="form-group col-md-2">
                                            <label>Precio Uni</label>
                                            <input id="precioUni" type="number" class="form-control"
                                                formControlName="precio">
                                        </div>
                                        <div class="form-group col-md-1">
                                            <label>Stock</label>
                                            <input id="stockK" type="number" class="form-control"
                                                formControlName="stock" [attr.disabled]="true">
                                        </div>
                                        <div class="form-group col-md-1">
                                            <label>Cantidad</label>
                                            <input id="cantidad" type="number" class="form-control"
                                                formControlName="cantidad" (keyup)="calcularTotal($event)">

                                        </div>
                                        <div class="form-group col-md-2">
                                            <label >Total</label>
                                            <input id="total" type="number" class="form-control" formControlName="total"
                                                [attr.disabled]="true">
                                        </div>
                                        <div class="form-group col-md-1  d-flex justify-content-center py-3 mt-2" >
                                            <button class="btn btn-success mt-1" type="button"
                                                (click)="addProducto()"><i class="bi bi-cart-plus"></i></button>
                                            <button class="btn btn-info mt-1 ml-2" type="button" (click)="clearProd()">
                                                <i class="bi bi-arrow-clockwise"></i></button>
                                         
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col bg-white rounded mx-2.5 mt-1 pb-2 ">
                            <div class="col">
                                <button type="button" class="btn btn-secondary btn-lg mt-2"
                                    (click)="openModal()">Realizar Pago</button>
                            </div>
                        </div>
                    </section>

                    <section class="row mt-1 bg-white">
                        <div class="col">
                            <table class="table text-center">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Referencia</th>
                                        <th>Precio Uni</th>
                                        <th>Cantidad</th>
                                        <th>Total</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="cuerpoTabla">
                                    <tr *ngFor="let i of arregloDetalle">
                                        <td>{{i.nombre}}</td>
                                        <td>{{i.referencia}}</td>
                                        <td>{{i.precio | currency}}</td>
                                        <td>{{i.cantidad}}</td>
                                        <td>{{i.total | currency}}</td>
                                        <td>
                                            <i type="button" class="bi bi-trash fa-lg text-danger mr-3"
                                                (click)=" eliminarProducto(i.referencia)">
                                            </i>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>SUBTOTAL</td>
                                        <td  id="totalFac">{{totalTabla()| currency}}</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </section>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Pago -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title " id="exampleModalLabel">Ventana de Cobros</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="doSomething()">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form [formGroup]="pago">
                    <div class="row">
                        <div class="col-12 mt-4 form-inline">
                            <label class=" col-sm-2 col-form-label">Metodo:</label>
                            <select id="metodo" class="form-control" formControlName="metodo">

                                <option selected>Datafono</option>
                                <option selected>Nequi</option>
                                <option selected>SisteCredito</option>
                                <option selected>Efectivo</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 mt-1">
                            <label class="col-sm-2 col-form-label">Total:</label>
                            <input type="number" placeholder="{{total}}" formControlName="total" [attr.disabled]="true">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 mt-1">
                            <label class="col-sm-2 col-form-label">Recibe:</label>
                            <input type="number" value="0" formControlName="recibe"
                                (keydown.enter)="calculoCambio($event)" formControlName="recibe">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 mt-1">
                            <label class="col-sm-2 col-form-label">Cambio:</label>
                            <input id="cambio" type="number" value="0" formControlName="cambio" [attr.disabled]="true"
                                formControlName="cambio">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 mt-1">
                            <label class="col-sm-2 col-form-label">Saldo:</label>
                            <input id="saldo" type="number" value="0" formControlName="saldo" [attr.disabled]="true"
                                formControlName="saldo">
                        </div>
                    </div>
                </form>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="doSomething()">Volver</button>
                <button type="button" class="btn btn-primary" [disabled]="isDisabled" (click)="conCartera()">Generar
                    Factura</button>
            </div>
        </div>
    </div>
</div>

<!--Modal Productos-->
<div class="modal fade" id="modalProductos" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title " id="exampleModalLabel">Productos</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeModalProductos()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <form>
                <div class="form-group">
                  <div class="input-group mt-4">
                    <div class="div input-group-text">
                      <i class="bi bi-search"></i>
                    </div>
                    <input type="text" name="filtrar" class="form-control " placeholder="Buscar Nombre Producto" [(ngModel)]="query1">
                  </div>
                </div>
               </form>
          <table *ngIf="productos.length > 0"  class="table table-striped mt-4">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Referencia</th>
                <th>Precio</th>
                <th>Stock</th>
         
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let i of productos | filtroUsuario : query1">
                <td>{{i.nombre}}</td>
                <td>{{i.referencia}}</td>
                <td>{{i.precio | currency}}</td>
                <td>{{i.stock }}</td>
                <td>
                    <i class="bi bi-check2-square text-info"(click)="checkProductos(i.id)"></i>
                </td>
                
              </tr>
              
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="closeModalProductos()">Volver</button>
  
        </div>
      </div>
    </div>
  </div>

<!--Modal Clientes-->
  <div class="modal fade" id="modalClientes" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title " id="exampleModalLabel">Clientes</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeModalClientes()">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <form>
                <div class="form-group">
                  <div class="input-group mt-4">
                    <div class="div input-group-text">
                      <i class="bi bi-search"></i>
                    </div>
                    <input type="text" name="filtrar" class="form-control " placeholder="Buscar por Documento" [(ngModel)]="query">
                  </div>
                </div>
               </form>
          <table *ngIf="clientes.length > 0"  class="table table-striped mt-4">
            <thead>
              <tr>
                <th>Documento</th>
                <th>Nombre</th>
                <th>Telefono</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let i of clientes | filtroCliente: query">
                <td>{{i.documento}}</td>
                <td>{{i.nombre}}</td>
                <td>{{i.telefono}}</td>
                <td>
                    <i class="bi bi-person-check text-info" (click)="checkCliente(i.id)"></i>
                </td>
                
              </tr>
              
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="closeModalClientes()">Volver</button>
  
        </div>
      </div>
    </div>
  </div>